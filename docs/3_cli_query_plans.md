Assume you have created tables shown in the file `2_cli_create_tables.md`

```SQL
SELECT * FROM dimension_csv;

+--------+------+---------+------+
| d_dkey | env  | service | host |
+--------+------+---------+------+
| A      | dev  | log     | ma   |
| B      | prod | log     | ma   |
| C      | prod | log     | vim  |
| D      | prod | trace   | vim  |
+--------+------+---------+------+
4 row(s) fetched.
```

## Explain

### Tree Explain

```SQL
-- Default
-- SET datafusion.explain.format = 'tree';

EXPLAIN SELECT * FROM dimension_csv;
+---------------+-------------------------------+
| plan_type     | plan                          |
+---------------+-------------------------------+
| physical_plan | ┌───────────────────────────┐ |
|               | │       DataSourceExec      │ |
|               | │    --------------------   │ |
|               | │          files: 1         │ |
|               | │        format: csv        │ |
|               | └───────────────────────────┘ |
|               |                               |
+---------------+-------------------------------+
1 row(s) fetched. 
```

### Indent Explain

```SQL
SET datafusion.explain.format = 'indent';


EXPLAIN SELECT * FROM dimension_csv;
+---------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| plan_type     | plan                                                                                                                                                                                                   |
+---------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| logical_plan  | TableScan: dimension_csv projection=[d_dkey, env, service, host]                                                                                                                                       |
| physical_plan | DataSourceExec: file_groups={1 group: [[Users/hoabinhnga.tran/datafusion-optimal-plans/testdata/dimension1/dimension_1.csv]]}, projection=[d_dkey, env, service, host], file_type=csv, has_header=true |
|               |                                                                                                                                                                                                        |
+---------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
2 row(s) fetched. 
```

## Logical Plan vs Physical Plan

### Logical Plan
- Plan of the SQL
- Same on any machines, any data layout, any statistics
- Not used to execute yet

### Physical Plan
Generated from logical plan for
- Current machine (e.g number of CPUs)
- Current data layout (number of files, how they are partitioned, sorted, ...)

## Explain Analyze

```SQL
EXPLAIN ANALYZE SELECT * FROM dimension_csv;

+-------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| plan_type         | plan                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
+-------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Plan with Metrics | DataSourceExec: file_groups={1 group: [[Users/hoabinhnga.tran/datafusion-optimal-plans/testdata/dimension1/dimension_1.csv]]}, projection=[d_dkey, env, service, host], file_type=csv, has_header=true, metrics=[output_rows=4, elapsed_compute=1ns, batches_split=0, file_open_errors=0, file_scan_errors=0, time_elapsed_opening=239.208µs, time_elapsed_processing=234.958µs, time_elapsed_scanning_total=180.375µs, time_elapsed_scanning_until_data=167.75µs] |
|                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
+-------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
1 row(s) fetched.
```

## Explain verbose

- To see verbose plans through logical & physical rules
- Mostly for debugging

```SQL
EXPLAIN VERBOSE SELECT * FROM dimension_csv;

+------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| plan_type                                                  | plan                                                                                                                                                                                                                                                                                      |
+------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| initial_logical_plan                                       | Projection: dimension_csv.d_dkey, dimension_csv.env, dimension_csv.service, dimension_csv.host                                                                                                                                                                                            |
|                                                            |   TableScan: dimension_csv                                                                                                                                                                                                                                                                |
| logical_plan after resolve_grouping_function               | SAME TEXT AS ABOVE                                                                                                                                                                                                                                                                        |
| logical_plan after type_coercion                           | SAME TEXT AS ABOVE                                                                                                                                                                                                                                                                        |
| analyzed_logical_plan                                      | SAME TEXT AS ABOVE                                                                                                                                                                                                                                                                        |
| logical_plan after eliminate_nested_union                  | SAME TEXT AS ABOVE                                                                                                                                                                                                                                                                        |
| logical_plan after simplify_expressions                    | SAME TEXT AS ABOVE                                                                                                                                                                                                                                                                        |
| logical_plan after replace_distinct_aggregate              | SAME TEXT AS ABOVE                                                                                                                                                                                                                                                                        |
| logical_plan after eliminate_join                          | SAME TEXT AS ABOVE                                                                                                                                                                                                                                                                        |
| logical_plan after decorrelate_predicate_subquery          | SAME TEXT AS ABOVE                                                                                                                                                                                                                                                                        |
| logical_plan after scalar_subquery_to_join                 | SAME TEXT AS ABOVE                                                                                                                                                                                                                                                                        |
| logical_plan after decorrelate_lateral_join                | SAME TEXT AS ABOVE                                                                                                                                                                                                                                                                        |
| logical_plan after extract_equijoin_predicate              | SAME TEXT AS ABOVE                                                                                                                                                                                                                                                                        |
| logical_plan after eliminate_duplicated_expr               | SAME TEXT AS ABOVE                                                                                                                                                                                                                                                                        |
| logical_plan after eliminate_filter                        | SAME TEXT AS ABOVE                                                                                                                                                                                                                                                                        |
| logical_plan after eliminate_cross_join                    | SAME TEXT AS ABOVE                                                                                                                                                                                                                                                                        |
| logical_plan after eliminate_limit                         | SAME TEXT AS ABOVE                                                                                                                                                                                                                                                                        |
| logical_plan after propagate_empty_relation                | SAME TEXT AS ABOVE                                                                                                                                                                                                                                                                        |
| logical_plan after eliminate_one_union                     | SAME TEXT AS ABOVE                                                                                                                                                                                                                                                                        |
| logical_plan after filter_null_join_keys                   | SAME TEXT AS ABOVE                                                                                                                                                                                                                                                                        |
| logical_plan after eliminate_outer_join                    | SAME TEXT AS ABOVE                                                                                                                                                                                                                                                                        |
| logical_plan after push_down_limit                         | SAME TEXT AS ABOVE                                                                                                                                                                                                                                                                        |
| logical_plan after push_down_filter                        | SAME TEXT AS ABOVE                                                                                                                                                                                                                                                                        |
| logical_plan after single_distinct_aggregation_to_group_by | SAME TEXT AS ABOVE                                                                                                                                                                                                                                                                        |
| logical_plan after eliminate_group_by_constant             | SAME TEXT AS ABOVE                                                                                                                                                                                                                                                                        |
| logical_plan after common_sub_expression_eliminate         | SAME TEXT AS ABOVE                                                                                                                                                                                                                                                                        |
| logical_plan after optimize_projections                    | TableScan: dimension_csv projection=[d_dkey, env, service, host]                                                                                                                                                                                                                          |
| logical_plan after eliminate_nested_union                  | SAME TEXT AS ABOVE                                                                                                                                                                                                                                                                        |
| logical_plan after simplify_expressions                    | SAME TEXT AS ABOVE                                                                                                                                                                                                                                                                        |
| logical_plan after replace_distinct_aggregate              | SAME TEXT AS ABOVE                                                                                                                                                                                                                                                                        |
| logical_plan after eliminate_join                          | SAME TEXT AS ABOVE                                                                                                                                                                                                                                                                        |
| logical_plan after decorrelate_predicate_subquery          | SAME TEXT AS ABOVE                                                                                                                                                                                                                                                                        |
| logical_plan after scalar_subquery_to_join                 | SAME TEXT AS ABOVE                                                                                                                                                                                                                                                                        |
| logical_plan after decorrelate_lateral_join                | SAME TEXT AS ABOVE                                                                                                                                                                                                                                                                        |
| logical_plan after extract_equijoin_predicate              | SAME TEXT AS ABOVE                                                                                                                                                                                                                                                                        |
| logical_plan after eliminate_duplicated_expr               | SAME TEXT AS ABOVE                                                                                                                                                                                                                                                                        |
| logical_plan after eliminate_filter                        | SAME TEXT AS ABOVE                                                                                                                                                                                                                                                                        |
| logical_plan after eliminate_cross_join                    | SAME TEXT AS ABOVE                                                                                                                                                                                                                                                                        |
| logical_plan after eliminate_limit                         | SAME TEXT AS ABOVE                                                                                                                                                                                                                                                                        |
| logical_plan after propagate_empty_relation                | SAME TEXT AS ABOVE                                                                                                                                                                                                                                                                        |
| logical_plan after eliminate_one_union                     | SAME TEXT AS ABOVE                                                                                                                                                                                                                                                                        |
| logical_plan after filter_null_join_keys                   | SAME TEXT AS ABOVE                                                                                                                                                                                                                                                                        |
| logical_plan after eliminate_outer_join                    | SAME TEXT AS ABOVE                                                                                                                                                                                                                                                                        |
| logical_plan after push_down_limit                         | SAME TEXT AS ABOVE                                                                                                                                                                                                                                                                        |
| logical_plan after push_down_filter                        | SAME TEXT AS ABOVE                                                                                                                                                                                                                                                                        |
| logical_plan after single_distinct_aggregation_to_group_by | SAME TEXT AS ABOVE                                                                                                                                                                                                                                                                        |
| logical_plan after eliminate_group_by_constant             | SAME TEXT AS ABOVE                                                                                                                                                                                                                                                                        |
| logical_plan after common_sub_expression_eliminate         | SAME TEXT AS ABOVE                                                                                                                                                                                                                                                                        |
| logical_plan after optimize_projections                    | SAME TEXT AS ABOVE                                                                                                                                                                                                                                                                        |
| logical_plan                                               | TableScan: dimension_csv projection=[d_dkey, env, service, host]                                                                                                                                                                                                                          |
| initial_physical_plan                                      | DataSourceExec: file_groups={1 group: [[Users/hoabinhnga.tran/datafusion-optimal-plans/testdata/dimension1/dimension_1.csv]]}, projection=[d_dkey, env, service, host], file_type=csv, has_header=true                                                                                    |
|                                                            |                                                                                                                                                                                                                                                                                           |
| initial_physical_plan_with_stats                           | DataSourceExec: file_groups={1 group: [[Users/hoabinhnga.tran/datafusion-optimal-plans/testdata/dimension1/dimension_1.csv]]}, projection=[d_dkey, env, service, host], file_type=csv, has_header=true, statistics=[Rows=Absent, Bytes=Absent, [(Col[0]:),(Col[1]:),(Col[2]:),(Col[3]:)]] |
|                                                            |                                                                                                                                                                                                                                                                                           |
| initial_physical_plan_with_schema                          | DataSourceExec: file_groups={1 group: [[Users/hoabinhnga.tran/datafusion-optimal-plans/testdata/dimension1/dimension_1.csv]]}, projection=[d_dkey, env, service, host], file_type=csv, has_header=true, schema=[d_dkey:Utf8;N, env:Utf8;N, service:Utf8;N, host:Utf8;N]                   |
|                                                            |                                                                                                                                                                                                                                                                                           |
| physical_plan after OutputRequirements                     | OutputRequirementExec: order_by=[], dist_by=Unspecified                                                                                                                                                                                                                                   |
|                                                            |   DataSourceExec: file_groups={1 group: [[Users/hoabinhnga.tran/datafusion-optimal-plans/testdata/dimension1/dimension_1.csv]]}, projection=[d_dkey, env, service, host], file_type=csv, has_header=true                                                                                  |
|                                                            |                                                                                                                                                                                                                                                                                           |
| physical_plan after aggregate_statistics                   | SAME TEXT AS ABOVE                                                                                                                                                                                                                                                                        |
| physical_plan after join_selection                         | SAME TEXT AS ABOVE                                                                                                                                                                                                                                                                        |
| physical_plan after LimitedDistinctAggregation             | SAME TEXT AS ABOVE                                                                                                                                                                                                                                                                        |
| physical_plan after FilterPushdown                         | SAME TEXT AS ABOVE                                                                                                                                                                                                                                                                        |
| physical_plan after EnforceDistribution                    | SAME TEXT AS ABOVE                                                                                                                                                                                                                                                                        |
| physical_plan after CombinePartialFinalAggregate           | SAME TEXT AS ABOVE                                                                                                                                                                                                                                                                        |
| physical_plan after EnforceSorting                         | SAME TEXT AS ABOVE                                                                                                                                                                                                                                                                        |
| physical_plan after OptimizeAggregateOrder                 | SAME TEXT AS ABOVE                                                                                                                                                                                                                                                                        |
| physical_plan after ProjectionPushdown                     | SAME TEXT AS ABOVE                                                                                                                                                                                                                                                                        |
| physical_plan after coalesce_batches                       | SAME TEXT AS ABOVE                                                                                                                                                                                                                                                                        |
| physical_plan after coalesce_async_exec_input              | SAME TEXT AS ABOVE                                                                                                                                                                                                                                                                        |
| physical_plan after OutputRequirements                     | DataSourceExec: file_groups={1 group: [[Users/hoabinhnga.tran/datafusion-optimal-plans/testdata/dimension1/dimension_1.csv]]}, projection=[d_dkey, env, service, host], file_type=csv, has_header=true                                                                                    |
|                                                            |                                                                                                                                                                                                                                                                                           |
| physical_plan after LimitAggregation                       | SAME TEXT AS ABOVE                                                                                                                                                                                                                                                                        |
| physical_plan after LimitPushPastWindows                   | SAME TEXT AS ABOVE                                                                                                                                                                                                                                                                        |
| physical_plan after LimitPushdown                          | SAME TEXT AS ABOVE                                                                                                                                                                                                                                                                        |
| physical_plan after ProjectionPushdown                     | SAME TEXT AS ABOVE                                                                                                                                                                                                                                                                        |
| physical_plan after EnsureCooperative                      | SAME TEXT AS ABOVE                                                                                                                                                                                                                                                                        |
| physical_plan after FilterPushdown(Post)                   | SAME TEXT AS ABOVE                                                                                                                                                                                                                                                                        |
| physical_plan after SanityCheckPlan                        | SAME TEXT AS ABOVE                                                                                                                                                                                                                                                                        |
| physical_plan                                              | DataSourceExec: file_groups={1 group: [[Users/hoabinhnga.tran/datafusion-optimal-plans/testdata/dimension1/dimension_1.csv]]}, projection=[d_dkey, env, service, host], file_type=csv, has_header=true                                                                                    |
|                                                            |                                                                                                                                                                                                                                                                                           |
| physical_plan_with_stats                                   | DataSourceExec: file_groups={1 group: [[Users/hoabinhnga.tran/datafusion-optimal-plans/testdata/dimension1/dimension_1.csv]]}, projection=[d_dkey, env, service, host], file_type=csv, has_header=true, statistics=[Rows=Absent, Bytes=Absent, [(Col[0]:),(Col[1]:),(Col[2]:),(Col[3]:)]] |
|                                                            |                                                                                                                                                                                                                                                                                           |
| physical_plan_with_schema                                  | DataSourceExec: file_groups={1 group: [[Users/hoabinhnga.tran/datafusion-optimal-plans/testdata/dimension1/dimension_1.csv]]}, projection=[d_dkey, env, service, host], file_type=csv, has_header=true, schema=[d_dkey:Utf8;N, env:Utf8;N, service:Utf8;N, host:Utf8;N]                   |
|                                                            |                                                                                                                                                                                                                                                                                           |
+------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
75 row(s) fetched. 

```
